{@layout path="page-template" /}

{<pageTitle}
    {@queryOne type="dennison:homePageContent" as="homePage"}
        <title>{homePage.pageTitle} - Home</title>
    {/queryOne}
{/pageTitle}

{<content}
<div class="row">
    <div class="col-md-3">
        {@block path="leftnav"/}
    </div>
    <div class="col-md-9">
        <div class="row">
            <div class="modules-list">
            {^module}
                {! training landing page. top level modules !}
                {@query type="dennison:module" as="modules" sort="displayOrder" sortDirection="1"}
                    {#modules}
                        {?topLevelModule}
                            {?active}
                                <div class="col-sm-6 col-md-4">
                                    <div class="thumbnail">
                                        <a href="/training/modules/{id}.html" data-insight-node="{insightNode}" data-insight-action="view-module">
                                            <img class="img-responsive module-min-height" src="{attachments.default.url}" alt="{title|s}">
                                        </a>
                                        <div class="caption">
                                            <a href="/training/modules/{id}.html"><h3 class="module-title">{title}</h3></a>

                                            {?settings.modules[id].progressPercentage}
                                            <div class="progress {^showProgress}hidden{/showProgress}">
                                              <div class="progress-bar" role="progressbar" aria-valuenow="{settings.modules[id].progressPercentage}" aria-valuemin="0" aria-valuemax="100" style="min-width: 2em; width: {settings.modules[id].progressPercentage}%;">
                                                  {settings.modules[id].progressPercentage}%
                                              </div>
                                            </div>
                                            {:else}
                                            <div class="progress {^showProgress}hidden{/showProgress}">
                                                <div class="progress-bar" role="progressbar" aria-valuenow="5" aria-valuemin="0" aria-valuemax="100" style="min-width: 2em;">
                                                  0%
                                                </div>
                                            </div>
                                            {/settings.modules[id].progressPercentage}

                                        </div>
                                    </div>
                                </div>
                            {/active}
                        {/topLevelModule}
                    {/modules}
                {/query}

                {@query type="dennison:product" as="products" sort="displayOrder"}
                    {! products with no parent module !}
                    {#products}
                        {?topLevelProduct}
                            {?active}
                                <div class="col-sm-6 col-md-4">
                                    <div class="thumbnail">
                                        {?isLink}
                                            {?isAttachmentLink}
                                                <a target="{linkTarget}" href="{attachments.download.url|s}/{attachments.download.filename}">
                                            {:else}
                                                <a target="{linkTarget}" href="{linkURL|s}">
                                            {/isAttachmentLink}
                                        {:else}
                                            <a href="/training/products/{id}/index.html">
                                        {/isLink}
                                            <img class="img-responsive module-min-height" src="{attachments.default.url|s}" alt="{title|s}">
                                        </a>
                                        <div class="caption">
                                            {?isLink}
                                                {?isAttachmentLink}
                                                    <a target="{linkTarget}" href="{attachments.download.url|s}/{attachments.download.filename}"><h3 class="module-title">{title}</h3></a>
                                                {:else}
                                                    <a target="{linkTarget}" href="{linkURL|s}"><h3 class="module-text-min-height">{title}</h3></a>
                                                {/isAttachmentLink}
                                            {:else}

                                                <a href="/training/products/{id}/index.html"><h3 class="module-title">{title}</h3></a>

                                                {?settings.products[id].progressPercentage}
                                                <div class="progress {^showProgress}hidden{/showProgress}">
                                                  <div class="progress-bar" role="progressbar" aria-valuenow="{settings.products[id].progressPercentage}" aria-valuemin="0" aria-valuemax="100" style="min-width: 2em; width: {settings.products[id].progressPercentage}%;">
                                                      {settings.products[id].progressPercentage}%
                                                  </div>
                                                </div>
                                                {:else}
                                                <div class="progress {^showProgress}hidden{/showProgress}">
                                                    <div class="progress-bar" role="progressbar" aria-valuenow="5" aria-valuemin="0" aria-valuemax="100" style="min-width: 2em;">
                                                      0%
                                                    </div>
                                                </div>
                                                {/settings.products[id].progressPercentage}

                                            {/isLink}
                                        </div>
                                    </div>
                                </div>
                            {/active}
                        {/topLevelProduct}
                    {/products}
                {/query}
            {:else}

                {@relatives type="dennison:module" node="{module._doc}" associationType="dennison:module-association" as="modules" direction="incoming" sort="displayOrder" sortDirection="1"}
                    {#modules}
                        {?active}
                            <div class="col-sm-6 col-md-4">
                                <div class="thumbnail">
                                    <a href="/training/modules/{id}.html" data-insight-node="{insightNode}" data-insight-action="view-module">
                                        <img class="img-responsive module-min-height" src="{attachments.default.url}" alt="{title|s}">
                                    </a>
                                    <div class="caption">
                                        <a href="/training/modules/{id}.html"><h3 class="module-title">{title}</h3></a>

                                        {?settings.modules[id].progressPercentage}
                                        <div class="progress {^showProgress}hidden{/showProgress}">
                                            <div class="progress-bar" role="progressbar" aria-valuenow="{settings.modules[id].progressPercentage}" aria-valuemin="0" aria-valuemax="100" style="min-width: 2em; width: {settings.modules[id].progressPercentage}%;">
                                                {settings.modules[id].progressPercentage}%
                                            </div>
                                        </div>
                                        {:else}
                                        <div class="progress {^showProgress}hidden{/showProgress}">
                                            <div class="progress-bar" role="progressbar" aria-valuenow="5" aria-valuemin="0" aria-valuemax="100" style="min-width: 2em;">
                                              0%
                                            </div>
                                        </div>
                                        {/settings.modules[id].progressPercentage}

                                    </div>
                                </div>
                            </div>
                        {/active}
                    {/modules}
                {/relatives}

                {@relatives type="dennison:product" node="{module._doc}" associationType="dennison:product-module-association" as="products" direction="incoming" sort="displayOrder"}
                     {#products}
                        {?active}
                            <div class="col-sm-6 col-md-4">
                                <div class="thumbnail">
                                    {?isLink}
                                        {?isAttachmentLink}
                                            <a target="{linkTarget}" href="{attachments.download.url}/{attachments.download.filename}">
                                        {:else}
                                            <a target="{linkTarget}" href="{linkURL}">
                                        {/isAttachmentLink}
                                    {:else}
                                        <a href="/training/modules/{module.id}/products/{id}/index.html">
                                    {/isLink}
                                        <img class="img-responsive module-min-height" src="{attachments.default.url}" alt="{title}">
                                    </a>
                                    <div class="caption">
                                        {?isLink}
                                            {?isAttachmentLink}
                                                <a target="{linkTarget}" href="{attachments.download.url}/{attachments.download.filename}"><h3 class="module-title">{title}</h3></a>
                                            {:else}
                                                <a target="{linkTarget}" href="{linkURL}"><h3 class="module-text-min-height">{title}</h3></a>
                                            {/isAttachmentLink}
                                        {:else}
                                            <a href="/training/modules/{module.id}/products/{id}/index.html"><h3 class="module-title">{title}</h3></a>

                                            {?settings.products[id].progressPercentage}
                                            <div class="progress {^showProgress}hidden{/showProgress}">
                                                <div class="progress-bar" role="progressbar" aria-valuenow="{settings.products[id].progressPercentage}" aria-valuemin="0" aria-valuemax="100" style="min-width: 2em; width: {settings.products[id].progressPercentage}%;">
                                                    {settings.products[id].progressPercentage}%
                                                </div>
                                            </div>
                                            {:else}
                                            <div class="progress {^showProgress}hidden{/showProgress}">
                                                <div class="progress-bar" role="progressbar" aria-valuenow="5" aria-valuemin="0" aria-valuemax="100" style="min-width: 2em;">
                                                  0%
                                                </div>
                                            </div>
                                            {/settings.products[id].progressPercentage}

                                        {/isLink}
                                    </div>
                                </div>
                            </div>

                        {/active}
                    {/products}
                {/relatives}

            {/module}
            </div>
        </div>
    </div>
</div>
{/content}
